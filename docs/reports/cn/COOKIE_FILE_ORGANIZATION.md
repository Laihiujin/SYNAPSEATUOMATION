# Cookieæ–‡ä»¶ç»„ç»‡è§„èŒƒ

## ğŸ“… åˆ›å»ºæ—¥æœŸ
2025-12-19

## ğŸ¯ ç›®æ ‡

å»ºç«‹ç»Ÿä¸€çš„Cookieæ–‡ä»¶å‘½åå’Œç®¡ç†è§„èŒƒï¼Œè§£å†³ä»¥ä¸‹é—®é¢˜ï¼š
1. âœ… ç¡®ä¿è´¦å·å”¯ä¸€æ€§ï¼ˆä½¿ç”¨user_idï¼‰
2. âœ… é¿å…é‡å¤å¤‡ä»½ï¼ˆåŒä¸€è´¦å·å¤šä¸ªæ–‡ä»¶ï¼‰
3. âœ… æ–‡ä»¶åæ¸…æ™°æ˜“è¯»
4. âœ… ä¾¿äºè‡ªåŠ¨åŒ–ç®¡ç†

---

## ğŸ“ ç»Ÿä¸€å‘½åè§„èŒƒ

### æ ¼å¼
```
{platform}_{user_id}.json
```

### ç¤ºä¾‹
```
douyin_12188823.json        # æŠ–éŸ³è´¦å·ï¼Œuser_id=12188823
kuaishou_2376346635.json    # å¿«æ‰‹è´¦å·ï¼Œuser_id=2376346635
xiaohongshu_5a8b2c3d.json   # å°çº¢ä¹¦è´¦å·ï¼Œuser_id=5a8b2c3d
bilibili_98765432.json      # Bç«™è´¦å·ï¼Œuser_id=98765432
channels_10001234.json      # è§†é¢‘å·è´¦å·ï¼Œuser_id=10001234
```

### ä¼˜åŠ¿
- âœ… **å”¯ä¸€æ€§**: user_idåœ¨å¹³å°å†…å”¯ä¸€ï¼Œä¸ä¼šé‡å¤
- âœ… **å¯è¯»æ€§**: ä¸€çœ¼çœ‹å‡ºå¹³å°å’Œè´¦å·
- âœ… **ç¨³å®šæ€§**: user_idä¸å˜ï¼Œæ–‡ä»¶åç¨³å®š
- âœ… **ç®€æ´æ€§**: å»é™¤æ—¶é—´æˆ³ï¼Œé¿å…é‡å¤

---

## ğŸ” User IDæå–è§„åˆ™

ç³»ç»Ÿè‡ªåŠ¨ä»Cookieæ•°æ®ä¸­æå–user_idï¼Œè§„åˆ™å¦‚ä¸‹ï¼š

### 1ï¸âƒ£ ä¼˜å…ˆçº§ï¼šuser_infoå­—æ®µ
æ‰€æœ‰å¹³å°ä¼˜å…ˆä» `user_info.user_id` æå–ï¼š
```json
{
  "user_info": {
    "user_id": "12188823",
    "nickname": "æµ‹è¯•è´¦å·"
  },
  "cookies": [...]
}
```

### 2ï¸âƒ£ å…œåº•ï¼šä»Cookiesæå–

| å¹³å° | Cookieå­—æ®µ |
|------|-----------|
| å¿«æ‰‹ | `userId`, `bUserId` |
| æŠ–éŸ³ | ä»…ä»user_infoæå– |
| å°çº¢ä¹¦ | ä»…Session IDï¼ˆä¸ä½œä¸ºuser_idï¼‰ |
| è§†é¢‘å· | `wxuin`, `uin` |
| Bç«™ | `DedeUserID`, `DedeUserID__ckMd5` |

### å®ç°ä»£ç 
å‚è€ƒ `syn_backend/myUtils/cookie_manager.py:151-197`

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

### æ ‡å‡†ç»“æ„
```
syn_backend/
â”œâ”€â”€ cookiesFile/                    â† ä¸»ç›®å½•ï¼ˆä½¿ç”¨ä¸­ï¼‰
â”‚   â”œâ”€â”€ douyin_12188823.json
â”‚   â”œâ”€â”€ kuaishou_2376346635.json
â”‚   â””â”€â”€ backups/                    â† å¤‡ä»½ç›®å½•
â”‚       â”œâ”€â”€ 20251219_143022_organize/  â† æ•´ç†æ—¶çš„å¤‡ä»½
â”‚       â””â”€â”€ 20251219_150000_manual/    â† æ‰‹åŠ¨å¤‡ä»½
â”œâ”€â”€ cookies/                        â† æ—§ç›®å½•ï¼ˆå·²åºŸå¼ƒï¼Œå¯åˆ é™¤ï¼‰
â””â”€â”€ config/cookies/                 â† æ—§ç›®å½•ï¼ˆå·²åºŸå¼ƒï¼Œå¯åˆ é™¤ï¼‰
```

### å¤‡ä»½ç­–ç•¥
- âœ… **è‡ªåŠ¨å¤‡ä»½**: æ•´ç†è„šæœ¬è¿è¡Œæ—¶è‡ªåŠ¨å¤‡ä»½
- âœ… **å¸¦æ—¶é—´æˆ³**: å¤‡ä»½ç›®å½•æ ¼å¼ `YYYYMMDD_HHMMSS_{purpose}`
- âœ… **ä¿ç•™æœŸé™**: å»ºè®®ä¿ç•™æœ€è¿‘3æ¬¡å¤‡ä»½
- âœ… **æ‰‹åŠ¨å¤‡ä»½**: é‡è¦æ“ä½œå‰å¯æ‰‹åŠ¨å¤‡ä»½

---

## ğŸ› ï¸ ä½¿ç”¨æ•´ç†è„šæœ¬

### è„šæœ¬ä½ç½®
```
scripts/maintenance/organize_cookies.py
```

### è¿è¡Œæ–¹å¼
```bash
cd E:\SynapseAutomation
python scripts\maintenance\organize_cookies.py
```

### è„šæœ¬åŠŸèƒ½
1. âœ… è‡ªåŠ¨å¤‡ä»½æ‰€æœ‰ç°æœ‰æ–‡ä»¶
2. âœ… ä»æ•°æ®åº“è¯»å–è´¦å·ä¿¡æ¯
3. âœ… è¯†åˆ«é‡å¤è´¦å·ï¼ˆåŒä¸€platform+user_idï¼‰
4. âœ… é‡å‘½åä¸ºè§„èŒƒæ ¼å¼
5. âœ… åˆ é™¤é‡å¤æ–‡ä»¶ï¼ˆä¿ç•™æœ€æ–°ï¼‰
6. âœ… è¾“å‡ºè¯¦ç»†æ—¥å¿—

### æ‰§è¡Œæµç¨‹
```
1ï¸âƒ£ å¤‡ä»½æ‰€æœ‰ç°æœ‰æ–‡ä»¶
   â†“
2ï¸âƒ£ ä»æ•°æ®åº“è·å–æ‰€æœ‰è´¦å·
   â†“
3ï¸âƒ£ æŒ‰ platform + user_id åˆ†ç»„
   â†“
4ï¸âƒ£ è¯†åˆ«é‡å¤è´¦å·
   â†“
5ï¸âƒ£ ä¿ç•™æœ€æ–°è®°å½•ï¼Œåˆ é™¤æ—§æ–‡ä»¶
   â†“
6ï¸âƒ£ é‡å‘½åä¸ºè§„èŒƒæ ¼å¼
   â†“
7ï¸âƒ£ è¾“å‡ºæ•´ç†æŠ¥å‘Š
```

### è¾“å‡ºç¤ºä¾‹
```
==========================================================
ğŸš€ Cookieæ–‡ä»¶æ•´ç†
==========================================================
ğŸ“ æ­¥éª¤1: å¤‡ä»½æ‰€æœ‰ç°æœ‰æ–‡ä»¶...
   æ‰¾åˆ° 45 ä¸ªcookieæ–‡ä»¶
âœ… å·²å¤‡ä»½åˆ°: E:\SynapseAutomation\syn_backend\cookiesFile\backups\20251219_143022\organize

ğŸ“ æ­¥éª¤2: ä»æ•°æ®åº“è·å–æ‰€æœ‰è´¦å·...
   æ•°æ®åº“ä¸­æœ‰ 38 ä¸ªè´¦å·è®°å½•

ğŸ“ æ­¥éª¤3: åˆ†æå’Œæ•´ç†...
==========================================================
   è¯†åˆ«å‡º 35 ä¸ªå”¯ä¸€è´¦å·ï¼ˆæŒ‰platform+user_idï¼‰

ğŸ” å‘ç°é‡å¤è´¦å·: douyin_12188823
   å…± 3 æ¡è®°å½•:
     - account_1765997803127: account_1765997803127.json (æµ‹è¯•è´¦å·)
     - account_1765448130315: account_1765448130315.json (æµ‹è¯•è´¦å·)
     - account_1765123456789: douyin_test_account.json (æµ‹è¯•è´¦å·)

ğŸ“ é‡å‘½å: account_1765997803127.json â†’ douyin_12188823.json
ğŸ—‘ï¸  åˆ é™¤é‡å¤æ–‡ä»¶: account_1765448130315.json
ğŸ—‘ï¸  åˆ é™¤é‡å¤æ–‡ä»¶: douyin_test_account.json

==========================================================
ğŸ“Š æ•´ç†å®Œæˆï¼
==========================================================
âœ… å¤‡ä»½ä½ç½®: E:\SynapseAutomation\syn_backend\cookiesFile\backups\20251219_143022\organize
âœ… é‡å‘½åæ–‡ä»¶æ•°: 28
âœ… å‘ç°é‡å¤è´¦å·æ•°: 3

ğŸ“ å½“å‰Cookieç›®å½•ç»“æ„ï¼š
   E:\SynapseAutomation\syn_backend\cookiesFile
   âœ… douyin_12188823.json
   âœ… kuaishou_2376346635.json
   âœ… xiaohongshu_5a8b2c3d.json
   ...

ğŸ’¡ å»ºè®®ï¼š
   1. æ£€æŸ¥ä¸Šè¿°æ–‡ä»¶åˆ—è¡¨ï¼Œç¡®è®¤æ— è¯¯
   2. å¦‚éœ€æ¢å¤ï¼Œå¤‡ä»½æ–‡ä»¶åœ¨: [å¤‡ä»½è·¯å¾„]
   3. åç»­æ–°è´¦å·å°†è‡ªåŠ¨ä½¿ç”¨è§„èŒƒå‘½å: {platform}_{user_id}.json
```

---

## ğŸ”„ æ›´æ–°Cookie Manager

### è‡ªåŠ¨ä½¿ç”¨è§„èŒƒå‘½å

ä¿®æ”¹ `syn_backend/myUtils/cookie_manager.py` çš„ `add_account()` æ–¹æ³•ï¼š

```python
def add_account(self, platform: str, cookie_file: str, name: str = "",
                user_id: str = "") -> str:
    """æ·»åŠ è´¦å·"""
    # å¦‚æœæä¾›äº†user_idï¼Œä½¿ç”¨è§„èŒƒå‘½å
    if user_id:
        normalized_name = f"{platform}_{user_id}.json"
        # å¦‚æœå½“å‰æ–‡ä»¶åä¸ç¬¦åˆè§„èŒƒï¼Œé‡å‘½å
        if cookie_file != normalized_name:
            old_path = Path(cookie_file)
            new_path = old_path.parent / normalized_name
            if old_path.exists():
                shutil.move(str(old_path), str(new_path))
                cookie_file = normalized_name

    # åç»­é€»è¾‘...
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: å¦‚æœæ²¡æœ‰user_idæ€ä¹ˆåŠï¼Ÿ
**A**: ä½¿ç”¨å…œåº•æ ¼å¼ `{platform}_account_{timestamp}.json`ï¼Œä½†å»ºè®®å®Œæˆç™»å½•åé‡æ–°æå–user_idã€‚

### Q2: é‡å‘½ååä¼šå½±å“æ•°æ®åº“å—ï¼Ÿ
**A**: ä¸ä¼šã€‚æ•°æ®åº“è®°å½•ä¼šéšç€æ–‡ä»¶é‡å‘½åä¸€èµ·æ›´æ–°ã€‚

### Q3: æ—§çš„å¤‡ä»½æ–‡ä»¶å¯ä»¥åˆ é™¤å—ï¼Ÿ
**A**: å¯ä»¥ã€‚å»ºè®®ä¿ç•™æœ€è¿‘3æ¬¡å¤‡ä»½ï¼Œåˆ é™¤æ›´æ—©çš„å¤‡ä»½ã€‚

### Q4: å¦‚ä½•æ¢å¤è¯¯åˆ çš„æ–‡ä»¶ï¼Ÿ
**A**: ä» `cookiesFile/backups/` ç›®å½•ä¸­æ‰¾åˆ°å¯¹åº”æ—¶é—´çš„å¤‡ä»½ï¼Œå¤åˆ¶å›ä¸»ç›®å½•ã€‚

### Q5: ä¸åŒå¹³å°çš„user_idä¼šé‡å¤å—ï¼Ÿ
**A**: ä¸ä¼šã€‚å‘½åæ ¼å¼åŒ…å«platformå‰ç¼€ï¼Œç¡®ä¿å”¯ä¸€æ€§ã€‚ä¾‹å¦‚ï¼š
   - `douyin_12345.json` â‰  `kuaishou_12345.json`

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1ï¸âƒ£ å®šæœŸæ•´ç†
å»ºè®®æ¯æœˆè¿è¡Œä¸€æ¬¡æ•´ç†è„šæœ¬ï¼Œæ¸…ç†é‡å¤æ–‡ä»¶ã€‚

### 2ï¸âƒ£ æ‰‹åŠ¨æ·»åŠ è´¦å·
æ–°å¢è´¦å·æ—¶ï¼Œå»ºè®®ä½¿ç”¨è§„èŒƒå‘½åï¼š
```bash
# ä¸æ¨è
account_1765997803127.json

# æ¨è
douyin_12188823.json
```

### 3ï¸âƒ£ å¤‡ä»½ç®¡ç†
- âœ… ä¿ç•™æœ€è¿‘3æ¬¡å¤‡ä»½
- âœ… é‡è¦æ“ä½œå‰æ‰‹åŠ¨å¤‡ä»½
- âœ… å®šæœŸå½’æ¡£æ—§å¤‡ä»½åˆ°å¤–éƒ¨å­˜å‚¨

### 4ï¸âƒ£ æ•°æ®åº“åŒæ­¥
æ•´ç†æ–‡ä»¶åï¼Œç¡®ä¿æ•°æ®åº“ `cookie_file` å­—æ®µå·²æ›´æ–°ã€‚

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- âœ… Cookieç®¡ç†å™¨: `syn_backend/myUtils/cookie_manager.py`
- âœ… æ•´ç†è„šæœ¬: `scripts/maintenance/organize_cookies.py`
- âœ… æ•°æ®åº“: `syn_backend/db/cookie_store.db`
- âœ… Cookieç›®å½•: `syn_backend/cookiesFile/`

---

**æœ€åæ›´æ–°**: 2025-12-19
**ç»´æŠ¤è€…**: SynapseAutomation Team
